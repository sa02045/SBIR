# 데이터링크 계층 : 랜에서 데이터 전송하기

OSI 모델의 두번째 계층인 데이터링크 계층에 대해 알아보자

- 네트워크 장비 간 신호를 주고받는 규칙을 정하는 계층이다
- 규칙중 가장 많이 사용되는 것이 `이더넷`이다

## 이더넷이란?

| 랜에서 데이터를 정상적으로 주고받기위해 적용되는 규칙

- 같은 허브를 사용하는 랜 환경에서는 특정 컴퓨터 한대에게 데이터를 보내려고 해도 다른 모든 컴퓨터에게도 전기신호가 전달된다

- 관계없는 다른 컴퓨터들이 그 데이터를 받아도 못보게 무시하기 위해서 보내려는 데이터에 `목적지`정보를 추가한다

- 허브는 들어온 데이터를 그대로 모든 포트에 보낼 뿐이다(더미허브)
- 여러대가 동시에 데이터를 보내면 `충돌`이 일어날 수 있다

| 이더넷은 충돌이 일어나지 않는 구조로 되어있다

- 이를 `CSMA/MD` 방법이라고 한다
- 데이터를 보내는 시점을 늦추는 것이다

1. 데이터를 보내려고하는 컴퓨터가 케이블에 신호가 흐르는지 확인한다
2. 흐르지 않고 있다면 데이터를 보내도 좋다
3. 충돌이 발생하는지 확인한다

위 규칙대로 데이터를 주고받아 충돌을 피한다

| 하지만 효율이 좋지않아 요즘에는 CSMA/CD방식을 사용하지 않는다

- 대신 `스위치` 네트워크 장비를 사용해서 충돌을 피한다

## 정리

1. 이더넷은 랜에서 데이터를 주고받기 위한 규칙이다
2. 데이터 충돌을 피하기 위해 CSMA/CD 방식을 사용한다

# MAC주소의 구조

## MAC주소란?

- 랜 카드는 비트(0과1)을 전기신호로 변환해준다
- 랜 카드에는 `MAC 주소`라는 물리 주소가 번호로 정해져있는데, `전세계에서 유일한 번호`로 할당된다

- 앞 24비트는 제조사 번호, 뒤 24비트는 일련번호이다

## 이더넷 헤더

- 데이터 링크 계층에서 `이더넷 헤더`와 `트레일러`를 붙인다
- 이더넷 헤더는 다음처럼 이루어져있다

  - MAC주소
  - 출발지 MAC주소
  - 유형 : 상위 계층 프로토콜의 종류의 식별번호 (IPv4, ARP, RARP, IPv6등등)

- 트레일러(FCS) : 데이터 전송중 오류체크

| 프레임 : 데이터 + 이더넷 헤더 + 트레일러

캡슐화 과정

1. 데이터링크 계층에서 프레임(데이터 + 이더넷 헤더 + 트레일러)로 캡슐화 한다
2. 물리 꼐층에서 프레임비트열을 전기신호로 변환하고 네트워크로 전송한다
3. 허브는 모든 포트로 전송한다.
4. 컴퓨터는 목적지 MAC 주소와 자신의 MAC주소를 비교해서 다르면 파기한다

5. 같다면 역캡슐화가 일어난다

## 정리

1. MAC주소는 48비트(앞 24비트(제조사), 뒤 24비트(일련번호))
2. 이더넷 헤더는 출발지 MAC주소, 도착지 MAC주소, 유형으로 이루어져있다
3. 트레일러 : 데이터 + 이데넛 헤더 + 트레일러

# 스위치의 구조

- 스위치는 네트워크 장비로 내부에는 MAC주소 테이블이 있다

## MAC 주소 테이블이란?

| 스위치의 포트번호 : 컴퓨터의 MAC주소가 등록되어있는 DB테이블 (해쉬테이블이라고 생각하면 될듯..?)

- 스위치의 전원을 켠 상태에는 아직 테이블에 아무것도 등록되어있지 않음
- 새로운 네트워크 전송이 되면 MAC주소테이블을 확인 후 등록되어 있지 않다면 새로운 MAC 주소를 포트와 함께 등록한다 (MAC 주소 학습 기능)

컴퓨터 1에서 컴퓨터 3으로 데이터를 전송하는 시점에서는

- 아직 컴퓨터 3의 MAC주소가 등록되어 있지 않은 시점이다
- 그렇기 때문에 다른 포트까지 모두 데이터를 전송하게 된다
- 이를 `플러딩`이라고 한다

| MAC주소가 등록되어 있자면 목적지 MAC주소에만 데이터가 전송된다 (MAC 주소 필터링)

## 정리

1. 스위치로 원하는 컴퓨터에만 데이터를 전송할 수 있다
2. MAC 주소 테이블은 포트와 MAC주소로 테이블을 만든다
3. 처음에는 등록되어 있지 않기 때문이 `플러딩`이 발생한다
4. 등록된 경우 MAC 주소 필터링으로 목적지에만 데이터를 전송한다

# 데이터가 케이블에서 충돌하지 않는 구조

## 전이중 통신, 반이중 통신이란?

- 전이중 : 회선을 여러개 사용해서 데이터 송수신을 동시에
- 반이중 : 회선 하나로 송신, 수신을 번갈아 가면서

컴퓨터 1과 컴퓨터 2를 전이중 방식으로 연결해도 `데이터를 동시에 전송해도 문제가 없다`
하지만 허브로 연결한 경우에는 데이터의 충돌이 일어난다

- 허브를 사용하면 반이중 통신방식을 사용한다.
- 스위치는 충돌이 일어나지 않는 구조이기 때문에 전이중통신으로 주고받는다
- 그렇기 때문에 스위치가 효율이 높기때문에 대부분 스위치를 사용한다

## 충돌 도메인이란?

총돌이 발상할 때 영향이 미치는 범위를 충돌 도메인이라고 한다

- 범위가 넓을 수록 네트워크가 지연된다

## 정리

- 전이중 통신방식이란 데이터의 송수신을 동시에 수행한다

- 반이중 통신방식이란 회선 한개로 송수신을 번갈아 수행한다

- 데이터 충돌이 발생하고 그 영향이 미치는 범위를 충돌 도메인이라고 한다

# ARP 프로토콜

| 목적지 IP주소를 이용하여 MAC 주소를 찾기위한 프로토콜이다

# 정리

1. 이더넷에서는 CSMA/CD 방식으로 데이터의 충돌을 방지한다

2. MAC 주소는 48비트로 (제조사비트+일련번호)로 이루어져 있다

3. 이더넷 헤더는 목적지 MAC주소(6비트) + 도착지 MAC 주소(6비트) + 유형(프로토콜의 식별번호)로 이루어져있다

4. 데이터링크 계층에서 데이터에 추가되는 것을 트레일러라고 한다

5. 스위치에는 포트번호와 포트번호에 접속하는 컴퓨터의 MAC주소를 담아있는 MAC 주소 테이블이 있다

6. 스위치에는 `플러딩`이 일어날 수 있다

7. 전이중 통신방식은 데이터의 송수신이 동시에 일어난다

8. 반이중 통신방식은 데이터의 송수신이 번갈아 일어난다

9. 데이터의 충돌이 발생하여 미치는 영향의 범위를 충돌 도메인이라고 한다

10. 데이터 링크 계층은 네트워크 기기간에 데이터를 전송하고 물리주소를 결정한다

11. 이더넷은 랜에서 활용되는 기술,규칙이다
12. 데이터를 여러군데서 동시에 받으면 충돌이라고 한다
13. MAC주소는 컴퓨터를 물리적으로 구분하기 위해 사용되는 고유번호이다
